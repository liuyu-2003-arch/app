<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººæ”¶è— - ç½‘å€å¯¼èˆª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #ffd4e5 0%, #e5d4ff 50%, #d4e5ff 100%);
            position: relative;
        }

        /* æµåŠ¨çº¿æ¡èƒŒæ™¯ */
        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            pointer-events: none;
            z-index: 0;
        }

        .wave-path {
            fill: none;
            stroke-width: 2;
            opacity: 0.15;
            animation: drift 20s ease-in-out infinite;
        }

        .wave-path-1 {
            stroke: #ff6b9d;
            animation-duration: 25s;
            animation-delay: 0s;
        }

        .wave-path-2 {
            stroke: #a855f7;
            animation-duration: 30s;
            animation-delay: -5s;
        }

        .wave-path-3 {
            stroke: #4285f4;
            animation-duration: 35s;
            animation-delay: -10s;
        }

        @keyframes drift {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(5%, 5%) rotate(5deg);
            }
            50% {
                transform: translate(-3%, 8%) rotate(-3deg);
            }
            75% {
                transform: translate(8%, -5%) rotate(8deg);
            }
        }

        .container {
            height: 100vh;
            padding: 60px 80px 60px 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .bookmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 30px;
            max-width: 1300px;
            width: 100%;
            max-height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        .bookmark-grid::-webkit-scrollbar {
            width: 8px;
        }

        .bookmark-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .bookmark-grid::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .bookmark-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            transition: transform 0.2s;
            cursor: grab;
            user-select: none;
        }

        .bookmark-item:hover {
            transform: translateY(-5px);
        }

        .bookmark-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .bookmark-item.drag-over {
            transform: scale(1.1);
        }

        .icon-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: white;
            position: relative;
            overflow: hidden;
        }

        .icon-wrapper img {
            width: 48px;
            height: 48px;
            object-fit: contain;
        }

        .icon-wrapper .fallback {
            font-size: 36px;
            font-weight: bold;
            color: #666;
        }

        .bookmark-name {
            font-size: 13px;
            color: #333;
            text-align: center;
            max-width: 100px;
            line-height: 1.3;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4285f4;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 2;
        }

        /* ç¼–è¾‘æŒ‰é’® */
        .edit-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.edit-mode .bookmark-item:hover .edit-btn {
            opacity: 1;
        }

        .edit-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* å…¨å±€ç¼–è¾‘æŒ‰é’® */
        .global-edit-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(100, 100, 100, 0.7);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }

        .global-edit-btn:hover,
        .show-edit-btn .global-edit-btn {
            opacity: 1;
        }

        .global-edit-btn:hover {
            background: rgba(80, 80, 80, 0.9);
            transform: scale(1.1);
        }

        body.edit-mode .global-edit-btn {
            background: rgba(66, 133, 244, 0.9);
            opacity: 1;
        }

        body.edit-mode .global-edit-btn:hover {
            background: rgba(53, 122, 232, 1);
        }

        /* æ·»åŠ æŒ‰é’® */
        .add-bookmark-btn {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: none;
            font-size: 32px;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        body.edit-mode .add-bookmark-btn {
            display: flex;
            animation: fadeInScale 0.3s ease forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .add-bookmark-btn:hover {
            background: rgba(67, 160, 71, 1);
            transform: scale(1.1) !important;
        }

        /* å¯¼å…¥å¯¼å‡ºæŒ‰é’® */
        .import-export-btns {
            position: fixed;
            bottom: 190px;
            right: 30px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        body.edit-mode .import-export-btns {
            display: flex;
            animation: fadeInScale 0.3s ease forwards;
            animation-delay: 0.1s;
            opacity: 0;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .import-export-btns button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .export-btn {
            background: rgba(255, 152, 0, 0.9);
        }

        .export-btn:hover {
            background: rgba(245, 124, 0, 1);
            transform: scale(1.1);
        }

        .import-btn {
            background: rgba(33, 150, 243, 0.9);
        }

        .import-btn:hover {
            background: rgba(25, 118, 210, 1);
            transform: scale(1.1);
        }

        .import-file-input {
            display: none;
        }

        /* è®¾ç½®æŒ‰é’® */
        .settings-btn {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(100, 100, 100, 0.3);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }

        .settings-btn:hover,
        .show-edit-btn .settings-btn {
            opacity: 1;
        }

        .settings-btn:hover {
            background: rgba(80, 80, 80, 0.7);
            transform: scale(1.1);
        }

        /* è®¾ç½®å¼¹çª— */
        .settings-modal .modal-content {
            max-width: 600px;
        }

        .settings-group {
            margin-bottom: 25px;
        }

        .settings-group h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
        }

        .settings-group p {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .github-url-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: monospace;
        }

        .github-url-input:focus {
            outline: none;
            border-color: #4285f4;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
        }

        .sync-status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .sync-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .sync-status.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* å³ä¸‹è§’è§¦å‘åŒºåŸŸ */
        .edit-trigger-area {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 120px;
            height: 120px;
            z-index: 99;
        }

        /* ç¼–è¾‘å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4285f4;
        }

        .icon-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .icon-preview-box {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: white;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .icon-preview-box img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: #4285f4;
            color: white;
        }

        .btn-primary:hover {
            background: #357ae8;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .help-text {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }
            
            .bookmark-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 20px;
            }
            
            .icon-wrapper {
                width: 70px;
                height: 70px;
            }

            .icon-wrapper img {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- æµåŠ¨çº¿æ¡èƒŒæ™¯ -->
    <svg class="wave" xmlns="http://www.w3.org/2000/svg">
        <path class="wave-path wave-path-1" d="M0,100 Q250,50 500,100 T1000,100 T1500,100 T2000,100" />
        <path class="wave-path wave-path-2" d="M0,200 Q300,150 600,200 T1200,200 T1800,200 T2400,200" />
        <path class="wave-path wave-path-3" d="M0,300 Q200,250 400,300 T800,300 T1200,300 T1600,300" />
        <path class="wave-path wave-path-1" d="M0,400 Q350,350 700,400 T1400,400 T2100,400" />
        <path class="wave-path wave-path-2" d="M0,500 Q280,480 560,500 T1120,500 T1680,500" />
        <path class="wave-path wave-path-3" d="M100,150 Q400,100 700,150 T1300,150 T1900,150" />
    </svg>

    <div class="container">
        <div class="bookmark-grid" id="bookmarkGrid">
            <!-- ä¹¦ç­¾é¡¹å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- å³ä¸‹è§’è§¦å‘åŒºåŸŸ -->
    <div class="edit-trigger-area" id="editTriggerArea"></div>

    <!-- è®¾ç½®æŒ‰é’® -->
    <button class="settings-btn" id="settingsBtn" title="è®¾ç½®">âš™ï¸</button>

    <!-- å¯¼å…¥å¯¼å‡ºæŒ‰é’® -->
    <div class="import-export-btns">
        <button class="export-btn" id="exportBtn" title="å¯¼å‡ºä¹¦ç­¾">ğŸ“¤</button>
        <button class="import-btn" id="importBtn" title="å¯¼å…¥ä¹¦ç­¾">ğŸ“¥</button>
    </div>
    <input type="file" class="import-file-input" id="importFileInput" accept=".json">

    <!-- æ·»åŠ ä¹¦ç­¾æŒ‰é’® -->
    <button class="add-bookmark-btn" id="addBookmarkBtn" title="æ·»åŠ ä¹¦ç­¾">
        +
    </button>

    <!-- å…¨å±€ç¼–è¾‘æŒ‰é’® -->
    <button class="global-edit-btn" id="globalEditBtn" title="ç¼–è¾‘æ¨¡å¼">
        âœï¸
    </button>

    <!-- ç¼–è¾‘å¼¹çª— -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">ç¼–è¾‘ä¹¦ç­¾</div>
            <form id="editForm">
                <div class="form-group">
                    <label>åç§°</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label>ç½‘å€</label>
                    <input type="url" id="editUrl" required>
                    <div class="help-text">è¾“å…¥å®Œæ•´çš„ç½‘å€ï¼Œå¦‚: https://www.example.com</div>
                </div>
                <div class="form-group">
                    <label>å›¾æ ‡ç±»å‹</label>
                    <select id="iconType">
                        <option value="auto">è‡ªåŠ¨è·å–ç½‘ç«™å›¾æ ‡</option>
                        <option value="emoji">ä½¿ç”¨è¡¨æƒ…ç¬¦å·</option>
                        <option value="text">ä½¿ç”¨æ–‡å­—</option>
                        <option value="custom">è‡ªå®šä¹‰å›¾ç‰‡é“¾æ¥</option>
                    </select>
                </div>
                <div class="form-group" id="iconCustomGroup" style="display: none;">
                    <label>å›¾æ ‡å†…å®¹</label>
                    <input type="text" id="iconCustom" placeholder="è¾“å…¥è¡¨æƒ…ç¬¦å·ã€æ–‡å­—æˆ–å›¾ç‰‡é“¾æ¥">
                    <div class="help-text">è¡¨æƒ…å¦‚: ğŸ¨ / æ–‡å­—å¦‚: A / å›¾ç‰‡é“¾æ¥å¦‚: https://...</div>
                </div>
                <div class="form-group">
                    <label>é¢„è§ˆ</label>
                    <div class="icon-preview">
                        <div class="icon-preview-box" id="iconPreview">
                            <span>ğŸ“Œ</span>
                        </div>
                        <span id="namePreview">ä¹¦ç­¾åç§°</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-delete" id="deleteBtn">åˆ é™¤</button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal settings-modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">è®¾ç½®</div>
            <div class="settings-group">
                <h3>GitHub åŒæ­¥</h3>
                <p>è®¾ç½® GitHub Raw URL åï¼Œæ¯æ¬¡æ‰“å¼€é¡µé¢ä¼šè‡ªåŠ¨ä» GitHub æ‹‰å–æœ€æ–°çš„ä¹¦ç­¾æ•°æ®ã€‚</p>
                <input type="text" 
                       class="github-url-input" 
                       id="githubUrlInput" 
                       placeholder="https://raw.githubusercontent.com/ç”¨æˆ·å/ä»“åº“å/main/bookmarks.json">
                <div class="help-text" style="margin-top: 8px;">
                    å¦‚ä½•è·å– Raw URLï¼š<br>
                    1. åœ¨ GitHub ä»“åº“ä¸­æ‰“å¼€ä½ çš„ bookmarks.json æ–‡ä»¶<br>
                    2. ç‚¹å‡» "Raw" æŒ‰é’®<br>
                    3. å¤åˆ¶æµè§ˆå™¨åœ°å€æ çš„ URL
                </div>
                <div id="syncStatus" style="display: none;"></div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" id="settingsCancelBtn">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="settingsSaveBtn">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script>
        // ä¹¦ç­¾æ•°æ®
        const bookmarks = [
            { name: 'Jemch', url: 'https://www.jemch.com', domain: 'jemch.com', fallback: 'J', iconType: 'auto' },
            { name: 'ç½‘ç«™æ”¶è—', url: '#', domain: '', fallback: 'ğŸ“‘', iconType: 'emoji' },
            { name: 'YouTube', url: 'https://www.youtube.com', domain: 'youtube.com', fallback: 'Y', iconType: 'auto' },
            { name: 'SubEasy', url: 'https://www.subeasy.ai', domain: 'subeasy.ai', fallback: 'S', iconType: 'auto' },
            { name: 'å“”å“©å“”å“©', url: 'https://www.bilibili.com', domain: 'bilibili.com', fallback: 'B', badge: 'NEW', iconType: 'auto' },
            { name: 'Notion', url: 'https://www.notion.so', domain: 'notion.so', fallback: 'N', iconType: 'auto' },
            { name: 'Grok', url: 'https://grok.x.ai', domain: 'x.ai', fallback: 'G', iconType: 'auto' },
            { name: 'Claude', url: 'https://claude.ai', domain: 'claude.ai', fallback: 'C', iconType: 'auto' },
            { name: 'ChatGPT', url: 'https://chat.openai.com', domain: 'openai.com', fallback: 'C', iconType: 'auto' },
            { name: 'Gemini', url: 'https://gemini.google.com', domain: 'gemini.google.com', fallback: 'G', iconType: 'auto' },
            { name: 'é˜¿é‡Œäº‘ç›˜', url: 'https://www.alipan.com', domain: 'alipan.com', fallback: 'äº‘', iconType: 'auto' },
            { name: 'Gmail', url: 'https://mail.google.com', domain: 'gmail.com', fallback: 'G', iconType: 'auto' },
            { name: 'Google è‰ºæœ¯', url: 'https://artsandculture.google.com', domain: 'artsandculture.google.com', fallback: 'ğŸ¨', iconType: 'auto' },
            { name: 'ç»´åŸºç™¾ç§‘', url: 'https://zh.wikipedia.org', domain: 'wikipedia.org', fallback: 'W', iconType: 'auto' },
            { name: 'Google', url: 'https://www.google.com', domain: 'google.com', fallback: 'G', iconType: 'auto' },
            { name: 'çº½çº¦æ—¶æŠ¥', url: 'https://www.nytimes.com', domain: 'nytimes.com', fallback: 'T', iconType: 'auto' },
            { name: 'BBC News ä¸­æ–‡', url: 'https://www.bbc.com/zhongwen/simp', domain: 'bbc.com', fallback: 'BBC', iconType: 'auto' },
            { name: 'è±†ç“£ç”µå½±', url: 'https://movie.douban.com', domain: 'douban.com', fallback: 'è±†', iconType: 'auto' },
            { name: 'çŒ«è·³ç›˜æœ', url: 'https://www.maopan.top', domain: 'maopan.top', fallback: 'ğŸ±', iconType: 'auto' },
            { name: 'UPäº‘æœ', url: 'https://www.upyunso.com', domain: 'upyunso.com', fallback: 'ğŸ”', iconType: 'auto' },
            { name: 'ç£åŠ›ç†Š', url: 'https://www.cilixiong.com', domain: 'cilixiong.com', fallback: 'ğŸ¼', iconType: 'auto' },
            { name: 'å¾—åˆ°', url: 'https://www.dedao.cn', domain: 'dedao.cn', fallback: 'å¾—', iconType: 'auto' },
            { name: 'Shadowsocks', url: 'https://shadowsocks.org', domain: 'shadowsocks.org', fallback: 'S', iconType: 'auto' },
            { name: 'Internet Archive', url: 'https://archive.org', domain: 'archive.org', fallback: 'ğŸ›ï¸', iconType: 'auto' },
            { name: 'GitHub', url: 'https://github.com', domain: 'github.com', fallback: 'GH', iconType: 'auto' },
            { name: 'å•å…ƒ 01 LED å…ƒä»¶çš„åŸºç¡€...', url: '#', domain: '', fallback: 'å•', iconType: 'text' },
            { name: 'æ–°ç–†æ™ºæ…§èµ‹ç¤ºæ•™æŠ•...', url: '#', domain: '', fallback: 'æ–°', iconType: 'text' },
            { name: 'Sora', url: 'https://sora.com', domain: 'sora.com', fallback: 'S', iconType: 'auto' }
        ];

        // ä» localStorage åŠ è½½ä¹¦ç­¾æ•°æ®
        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarksData');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return bookmarks;
                }
            }
            return bookmarks;
        }

        // ä¿å­˜ä¹¦ç­¾æ•°æ®
        function saveBookmarks(data) {
            localStorage.setItem('bookmarksData', JSON.stringify(data));
        }

        // ä» GitHub åŠ è½½ä¹¦ç­¾
        async function loadFromGitHub() {
            const githubUrl = localStorage.getItem('githubSyncUrl');
            if (!githubUrl) return false;

            try {
                const response = await fetch(githubUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                
                if (!Array.isArray(data)) {
                    throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                }

                // ä¿å­˜åˆ°æœ¬åœ°
                saveBookmarks(data);
                return true;
            } catch (error) {
                console.error('ä» GitHub åŠ è½½å¤±è´¥:', error);
                return false;
            }
        }

        // æ¸²æŸ“ä¹¦ç­¾
        function renderBookmarks() {
            const grid = document.getElementById('bookmarkGrid');
            const bookmarksData = loadBookmarks();
            
            grid.innerHTML = bookmarksData.map((bookmark, index) => {
                let iconHtml = '';
                
                if (bookmark.iconType === 'auto' && bookmark.domain) {
                    iconHtml = `
                        <img src="https://www.google.com/s2/favicons?domain=${bookmark.domain}&sz=128" 
                             alt="${bookmark.name}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="fallback" style="display:none;">${bookmark.fallback}</span>
                    `;
                } else if (bookmark.iconType === 'custom' && bookmark.customIcon && bookmark.customIcon.startsWith('http')) {
                    iconHtml = `
                        <img src="${bookmark.customIcon}" 
                             alt="${bookmark.name}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="fallback" style="display:none;">${bookmark.fallback}</span>
                    `;
                } else {
                    iconHtml = `<span class="fallback">${bookmark.customIcon || bookmark.fallback}</span>`;
                }
                
                return `
                    <a href="${bookmark.url}" 
                       class="bookmark-item" 
                       target="_blank" 
                       data-name="${bookmark.name}"
                       data-index="${index}"
                       draggable="true">
                        <div class="icon-wrapper">
                            ${iconHtml}
                            ${bookmark.badge ? `<span class="badge">${bookmark.badge}</span>` : ''}
                        </div>
                        <div class="bookmark-name">${bookmark.name}</div>
                        <button class="edit-btn" onclick="event.preventDefault(); event.stopPropagation(); openEditModal(${index})">âœï¸</button>
                    </a>
                `;
            }).join('');

            // æ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬
            initDragAndDrop();
        }

        // æ‹–æ‹½åŠŸèƒ½
        let draggedElement = null;
        let draggedIndex = null;

        function initDragAndDrop() {
            const items = document.querySelectorAll('.bookmark-item');

            items.forEach((item, index) => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragenter', handleDragEnter);
                item.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // ç§»é™¤æ‰€æœ‰é«˜äº®
            document.querySelectorAll('.bookmark-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const dropIndex = parseInt(this.dataset.index);
                const grid = document.getElementById('bookmarkGrid');
                const items = Array.from(grid.children);

                // é‡æ–°æ’åˆ—å…ƒç´ 
                if (draggedIndex < dropIndex) {
                    grid.insertBefore(draggedElement, this.nextSibling);
                } else {
                    grid.insertBefore(draggedElement, this);
                }

                // æ›´æ–°ç´¢å¼•
                Array.from(grid.children).forEach((item, idx) => {
                    item.dataset.index = idx;
                });

                // ä¿å­˜æ–°é¡ºåº
                saveBookmarkOrder();
            }

            this.classList.remove('drag-over');
            return false;
        }

        // ä¿å­˜ä¹¦ç­¾é¡ºåº
        function saveBookmarkOrder() {
            const items = document.querySelectorAll('.bookmark-item');
            const bookmarksData = loadBookmarks();
            const newOrder = [];
            
            items.forEach(item => {
                const name = item.dataset.name;
                const bookmark = bookmarksData.find(b => b.name === name);
                if (bookmark) {
                    newOrder.push(bookmark);
                }
            });
            
            saveBookmarks(newOrder);
        }

        // ç¼–è¾‘åŠŸèƒ½
        let currentEditIndex = null;

        function openEditModal(index) {
            currentEditIndex = index;
            const bookmarksData = loadBookmarks();
            const bookmark = bookmarksData[index];
            
            document.getElementById('editName').value = bookmark.name;
            document.getElementById('editUrl').value = bookmark.url;
            document.getElementById('iconType').value = bookmark.iconType || 'auto';
            document.getElementById('iconCustom').value = bookmark.customIcon || '';
            
            // æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
            document.getElementById('deleteBtn').style.display = 'block';
            
            updateIconCustomGroup();
            updatePreview();
            
            document.getElementById('editModal').classList.add('show');
        }

        function openAddModal() {
            currentEditIndex = null;
            
            // æ¸…ç©ºè¡¨å•
            document.getElementById('editName').value = '';
            document.getElementById('editUrl').value = '';
            document.getElementById('iconType').value = 'auto';
            document.getElementById('iconCustom').value = '';
            
            // éšè—åˆ é™¤æŒ‰é’®
            document.getElementById('deleteBtn').style.display = 'none';
            
            // æ›´æ–°æ ‡é¢˜
            document.querySelector('.modal-header').textContent = 'æ·»åŠ ä¹¦ç­¾';
            
            updateIconCustomGroup();
            updatePreview();
            
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            document.querySelector('.modal-header').textContent = 'ç¼–è¾‘ä¹¦ç­¾';
            currentEditIndex = null;
        }

        function updateIconCustomGroup() {
            const iconType = document.getElementById('iconType').value;
            const customGroup = document.getElementById('iconCustomGroup');
            const customInput = document.getElementById('iconCustom');
            
            if (iconType === 'auto') {
                customGroup.style.display = 'none';
            } else {
                customGroup.style.display = 'block';
                if (iconType === 'emoji') {
                    customInput.placeholder = 'è¾“å…¥è¡¨æƒ…ç¬¦å·ï¼Œå¦‚: ğŸ¨';
                } else if (iconType === 'text') {
                    customInput.placeholder = 'è¾“å…¥æ–‡å­—ï¼Œå¦‚: A';
                } else if (iconType === 'custom') {
                    customInput.placeholder = 'è¾“å…¥å›¾ç‰‡é“¾æ¥ï¼Œå¦‚: https://...';
                }
            }
            updatePreview();
        }

        function updatePreview() {
            const name = document.getElementById('editName').value || 'ä¹¦ç­¾åç§°';
            const url = document.getElementById('editUrl').value;
            const iconType = document.getElementById('iconType').value;
            const customIcon = document.getElementById('iconCustom').value;
            const preview = document.getElementById('iconPreview');
            
            document.getElementById('namePreview').textContent = name;
            
            if (iconType === 'auto' && url) {
                try {
                    const domain = new URL(url).hostname;
                    preview.innerHTML = `<img src="https://www.google.com/s2/favicons?domain=${domain}&sz=128" alt="${name}" onerror="this.style.display='none';">`;
                } catch {
                    preview.innerHTML = '<span>ğŸ”—</span>';
                }
            } else if (iconType === 'custom' && customIcon && customIcon.startsWith('http')) {
                preview.innerHTML = `<img src="${customIcon}" alt="${name}" onerror="this.parentElement.innerHTML='<span>âŒ</span>';">`;
            } else {
                preview.innerHTML = `<span>${customIcon || 'ğŸ“Œ'}</span>`;
            }
        }

        function saveEdit() {
            const bookmarksData = loadBookmarks();
            const name = document.getElementById('editName').value.trim();
            const url = document.getElementById('editUrl').value.trim();
            const iconType = document.getElementById('iconType').value;
            const customIcon = document.getElementById('iconCustom').value.trim();
            
            if (!name || !url) {
                alert('è¯·å¡«å†™åç§°å’Œç½‘å€');
                return;
            }

            // éªŒè¯ URL æ ¼å¼
            try {
                new URL(url);
            } catch {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€ï¼ˆéœ€è¦åŒ…å« http:// æˆ– https://ï¼‰');
                return;
            }
            
            // åˆ›å»ºä¹¦ç­¾å¯¹è±¡
            const bookmark = {
                name,
                url,
                iconType,
                customIcon,
                domain: iconType === 'auto' ? new URL(url).hostname : '',
                fallback: customIcon || name.charAt(0)
            };

            if (currentEditIndex === null) {
                // æ·»åŠ æ–°ä¹¦ç­¾
                bookmarksData.push(bookmark);
            } else {
                // æ›´æ–°ç°æœ‰ä¹¦ç­¾
                bookmarksData[currentEditIndex] = {
                    ...bookmarksData[currentEditIndex],
                    ...bookmark
                };
            }
            
            saveBookmarks(bookmarksData);
            closeEditModal();
            renderBookmarks();
        }

        function deleteBookmark() {
            if (currentEditIndex === null) return;
            
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªä¹¦ç­¾å—ï¼Ÿ')) return;
            
            const bookmarksData = loadBookmarks();
            bookmarksData.splice(currentEditIndex, 1);
            saveBookmarks(bookmarksData);
            closeEditModal();
            renderBookmarks();
        }

        // é˜»æ­¢é»˜è®¤çš„ç‚¹å‡»è¡Œä¸ºï¼ˆæ‹–æ‹½æ—¶ï¼‰
        document.addEventListener('DOMContentLoaded', async () => {
            // é¦–å…ˆå°è¯•ä» GitHub åŠ è½½
            const githubUrl = localStorage.getItem('githubSyncUrl');
            if (githubUrl) {
                const loaded = await loadFromGitHub();
                if (loaded) {
                    console.log('å·²ä» GitHub åŒæ­¥æœ€æ–°ä¹¦ç­¾');
                }
            }

            renderBookmarks();
            
            // é˜»æ­¢æ‹–æ‹½æ—¶æ‰“å¼€é“¾æ¥
            document.addEventListener('click', (e) => {
                const item = e.target.closest('.bookmark-item');
                if (item && item.classList.contains('dragging')) {
                    e.preventDefault();
                }
            });

            // å³ä¸‹è§’è§¦å‘åŒºåŸŸ - é¼ æ ‡ç§»å…¥æ˜¾ç¤ºç¼–è¾‘æŒ‰é’®
            const triggerArea = document.getElementById('editTriggerArea');
            triggerArea.addEventListener('mouseenter', () => {
                document.body.classList.add('show-edit-btn');
            });

            triggerArea.addEventListener('mouseleave', () => {
                // å¦‚æœä¸åœ¨ç¼–è¾‘æ¨¡å¼ï¼Œåˆ™éšè—æŒ‰é’®
                if (!document.body.classList.contains('edit-mode')) {
                    document.body.classList.remove('show-edit-btn');
                }
            });

            // å…¨å±€ç¼–è¾‘æŒ‰é’®
            document.getElementById('globalEditBtn').addEventListener('click', () => {
                document.body.classList.toggle('edit-mode');
                const btn = document.getElementById('globalEditBtn');
                if (document.body.classList.contains('edit-mode')) {
                    btn.textContent = 'âœ“';
                    btn.title = 'å®Œæˆç¼–è¾‘';
                    document.body.classList.add('show-edit-btn');
                } else {
                    btn.textContent = 'âœï¸';
                    btn.title = 'ç¼–è¾‘æ¨¡å¼';
                }
            });

            // æ·»åŠ ä¹¦ç­¾æŒ‰é’®
            document.getElementById('addBookmarkBtn').addEventListener('click', () => {
                openAddModal();
            });

            // å¯¼å‡ºä¹¦ç­¾
            document.getElementById('exportBtn').addEventListener('click', () => {
                const bookmarksData = loadBookmarks();
                const dataStr = JSON.stringify(bookmarksData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `bookmarks_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert('ä¹¦ç­¾å·²å¯¼å‡ºï¼\n\nä½ å¯ä»¥å°†æ­¤æ–‡ä»¶ä¸Šä¼ åˆ° GitHub ä»“åº“ä½œä¸ºå¤‡ä»½ã€‚');
            });

            // å¯¼å…¥ä¹¦ç­¾
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFileInput').click();
            });

            document.getElementById('importFileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        if (!Array.isArray(importedData)) {
                            throw new Error('æ— æ•ˆçš„ä¹¦ç­¾æ•°æ®æ ¼å¼');
                        }

                        // éªŒè¯æ•°æ®ç»“æ„
                        const isValid = importedData.every(item => 
                            item.name && item.url && typeof item.name === 'string' && typeof item.url === 'string'
                        );

                        if (!isValid) {
                            throw new Error('ä¹¦ç­¾æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                        }

                        // è¯¢é—®æ˜¯å¦è¦†ç›–
                        const shouldMerge = confirm(
                            `æ£€æµ‹åˆ° ${importedData.length} ä¸ªä¹¦ç­¾\n\n` +
                            'ç¡®å®šï¼šæ›¿æ¢å½“å‰æ‰€æœ‰ä¹¦ç­¾\n' +
                            'å–æ¶ˆï¼šåˆå¹¶åˆ°ç°æœ‰ä¹¦ç­¾'
                        );

                        if (shouldMerge) {
                            // æ›¿æ¢
                            saveBookmarks(importedData);
                        } else {
                            // åˆå¹¶
                            const currentData = loadBookmarks();
                            const mergedData = [...currentData, ...importedData];
                            saveBookmarks(mergedData);
                        }

                        renderBookmarks();
                        alert('ä¹¦ç­¾å¯¼å…¥æˆåŠŸï¼');
                        
                    } catch (error) {
                        alert('å¯¼å…¥å¤±è´¥ï¼š' + error.message);
                    }
                };
                reader.readAsText(file);
                
                // é‡ç½®æ–‡ä»¶è¾“å…¥
                e.target.value = '';
            });

            // ç¼–è¾‘å¼¹çª—äº‹ä»¶
            document.getElementById('iconType').addEventListener('change', updateIconCustomGroup);
            document.getElementById('editName').addEventListener('input', updatePreview);
            document.getElementById('editUrl').addEventListener('input', updatePreview);
            document.getElementById('iconCustom').addEventListener('input', updatePreview);
            document.getElementById('cancelBtn').addEventListener('click', closeEditModal);
            document.getElementById('deleteBtn').addEventListener('click', deleteBookmark);
            
            document.getElementById('editForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveEdit();
            });

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('editModal').addEventListener('click', (e) => {
                if (e.target.id === 'editModal') {
                    closeEditModal();
                }
            });

            // è®¾ç½®æŒ‰é’®
            document.getElementById('settingsBtn').addEventListener('click', () => {
                const currentUrl = localStorage.getItem('githubSyncUrl') || '';
                document.getElementById('githubUrlInput').value = currentUrl;
                document.getElementById('syncStatus').style.display = 'none';
                document.getElementById('settingsModal').classList.add('show');
            });

            // è®¾ç½®å¼¹çª—
            document.getElementById('settingsCancelBtn').addEventListener('click', () => {
                document.getElementById('settingsModal').classList.remove('show');
            });

            document.getElementById('settingsSaveBtn').addEventListener('click', async () => {
                const url = document.getElementById('githubUrlInput').value.trim();
                const statusDiv = document.getElementById('syncStatus');
                
                if (!url) {
                    // æ¸…é™¤è®¾ç½®
                    localStorage.removeItem('githubSyncUrl');
                    statusDiv.className = 'sync-status info';
                    statusDiv.textContent = 'âœ“ å·²æ¸…é™¤ GitHub åŒæ­¥è®¾ç½®';
                    statusDiv.style.display = 'flex';
                    setTimeout(() => {
                        document.getElementById('settingsModal').classList.remove('show');
                    }, 1500);
                    return;
                }

                // éªŒè¯ URL æ ¼å¼
                if (!url.startsWith('https://raw.githubusercontent.com/')) {
                    statusDiv.className = 'sync-status error';
                    statusDiv.textContent = 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ GitHub Raw URL';
                    statusDiv.style.display = 'flex';
                    return;
                }

                // æµ‹è¯• URL æ˜¯å¦å¯è®¿é—®
                statusDiv.className = 'sync-status info';
                statusDiv.textContent = 'â³ æ­£åœ¨æµ‹è¯•è¿æ¥...';
                statusDiv.style.display = 'flex';

                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`æ— æ³•è®¿é—® (${response.status})`);
                    }
                    const data = await response.json();
                    
                    if (!Array.isArray(data)) {
                        throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }

                    // ä¿å­˜è®¾ç½®
                    localStorage.setItem('githubSyncUrl', url);
                    
                    // æ›´æ–°ä¹¦ç­¾
                    saveBookmarks(data);
                    renderBookmarks();

                    statusDiv.className = 'sync-status success';
                    statusDiv.textContent = `âœ“ è¿æ¥æˆåŠŸï¼å·²åŒæ­¥ ${data.length} ä¸ªä¹¦ç­¾`;
                    statusDiv.style.display = 'flex';

                    setTimeout(() => {
                        document.getElementById('settingsModal').classList.remove('show');
                    }, 1500);

                } catch (error) {
                    statusDiv.className = 'sync-status error';
                    statusDiv.textContent = `âŒ è¿æ¥å¤±è´¥: ${error.message}`;
                    statusDiv.style.display = 'flex';
                }
            });

            // ç‚¹å‡»è®¾ç½®å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('settingsModal').addEventListener('click', (e) => {
                if (e.target.id === 'settingsModal') {
                    document.getElementById('settingsModal').classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
