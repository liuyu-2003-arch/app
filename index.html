<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏™‰∫∫Êî∂Ëóè - ÁΩëÂùÄÂØºËà™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #ffd4e5 0%, #e5d4ff 50%, #d4e5ff 100%);
            position: relative;
        }

        /* ÊµÅÂä®Á∫øÊù°ËÉåÊôØ */
        .wave {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            pointer-events: none;
            z-index: 0;
        }

        .wave-path {
            fill: none;
            stroke-width: 2;
            opacity: 0.15;
            animation: drift 20s ease-in-out infinite;
        }

        .wave-path-1 {
            stroke: #ff6b9d;
            animation-duration: 25s;
            animation-delay: 0s;
        }

        .wave-path-2 {
            stroke: #a855f7;
            animation-duration: 30s;
            animation-delay: -5s;
        }

        .wave-path-3 {
            stroke: #4285f4;
            animation-duration: 35s;
            animation-delay: -10s;
        }

        @keyframes drift {
            0%, 100% {
                transform: translate(0, 0) rotate(0deg);
            }
            25% {
                transform: translate(5%, 5%) rotate(5deg);
            }
            50% {
                transform: translate(-3%, 8%) rotate(-3deg);
            }
            75% {
                transform: translate(8%, -5%) rotate(8deg);
            }
        }

        .container {
            height: 100vh;
            padding: 60px 80px 60px 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        .bookmark-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 30px;
            max-width: 1300px;
            width: 100%;
            max-height: 100%;
            overflow-y: auto;
            padding: 20px;
        }

        .bookmark-grid::-webkit-scrollbar {
            width: 8px;
        }

        .bookmark-grid::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .bookmark-grid::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        .bookmark-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            transition: transform 0.2s;
            cursor: grab;
            user-select: none;
        }

        .bookmark-item:hover {
            transform: translateY(-5px);
        }

        .bookmark-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .bookmark-item.drag-over {
            transform: scale(1.05);
        }

        /* ÊãñÊãΩÊèíÂÖ•ÊåáÁ§∫Âô® */
        .drop-indicator {
            position: absolute;
            width: 4px;
            height: 100%;
            background: #4285f4;
            border-radius: 2px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 0 8px rgba(66, 133, 244, 0.5);
        }

        .drop-indicator.show {
            opacity: 1;
        }

        .drop-indicator.left {
            left: -15px;
        }

        .drop-indicator.right {
            right: -15px;
        }

        .icon-wrapper {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: white;
            position: relative;
            overflow: hidden;
        }

        .icon-wrapper img {
            width: 48px;
            height: 48px;
            object-fit: contain;
        }

        .icon-wrapper .fallback {
            font-size: 36px;
            font-weight: bold;
            color: #666;
        }

        .bookmark-name {
            font-size: 13px;
            color: #333;
            text-align: center;
            max-width: 100px;
            line-height: 1.3;
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #4285f4;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 2;
        }

        /* ÁºñËæëÊåâÈíÆ */
        .edit-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: rgba(0, 0, 0, 0.5);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.edit-mode .bookmark-item:hover .edit-btn {
            opacity: 1;
        }

        .edit-btn:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        /* ÂÖ®Â±ÄÁºñËæëÊåâÈíÆ */
        .global-edit-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(100, 100, 100, 0.7);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }

        .global-edit-btn:hover,
        .show-edit-btn .global-edit-btn {
            opacity: 1;
        }

        .global-edit-btn:hover {
            background: rgba(80, 80, 80, 0.9);
            transform: scale(1.1);
        }

        body.edit-mode .global-edit-btn {
            background: rgba(66, 133, 244, 0.9);
            opacity: 1;
        }

        body.edit-mode .global-edit-btn:hover {
            background: rgba(53, 122, 232, 1);
        }

        /* Ê∑ªÂä†ÊåâÈíÆ */
        .add-bookmark-btn {
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            border: none;
            font-size: 32px;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
        }

        body.edit-mode .add-bookmark-btn {
            display: flex;
            animation: fadeInScale 0.3s ease forwards;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .add-bookmark-btn:hover {
            background: rgba(67, 160, 71, 1);
            transform: scale(1.1) !important;
        }

        /* ÂØºÂÖ•ÂØºÂá∫ÊåâÈíÆ */
        .import-export-btns {
            position: fixed;
            bottom: 190px;
            right: 30px;
            display: none;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        body.edit-mode .import-export-btns {
            display: flex;
            animation: fadeInScale 0.3s ease forwards;
            animation-delay: 0.1s;
            opacity: 0;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .import-export-btns button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .export-btn {
            background: rgba(255, 152, 0, 0.9);
        }

        .export-btn:hover {
            background: rgba(245, 124, 0, 1);
            transform: scale(1.1);
        }

        /* ËÆæÁΩÆÊåâÈíÆ */
        .settings-btn {
            position: fixed;
            top: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(100, 100, 100, 0.3);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
        }

        .settings-btn:hover,
        .show-edit-btn .settings-btn {
            opacity: 1;
        }

        .settings-btn:hover {
            background: rgba(80, 80, 80, 0.7);
            transform: scale(1.1);
        }

        /* ËÆæÁΩÆÂºπÁ™ó */
        .settings-modal .modal-content {
            max-width: 600px;
        }

        .settings-group {
            margin-bottom: 25px;
        }

        .settings-group h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 10px;
        }

        .settings-group p {
            font-size: 13px;
            color: #666;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .github-url-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-family: monospace;
        }

        .github-url-input:focus {
            outline: none;
            border-color: #4285f4;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
        }

        .sync-status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .sync-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .sync-status.info {
            background: #e3f2fd;
            color: #1565c0;
        }

        /* Âè≥‰∏ãËßíËß¶ÂèëÂå∫Âüü */
        .edit-trigger-area {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 120px;
            height: 120px;
            z-index: 99;
        }

        /* ÁºñËæëÂºπÁ™ó */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4285f4;
        }

        .icon-preview {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .icon-preview-box {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: white;
            border: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .icon-preview-box img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: #4285f4;
            color: white;
        }

        .btn-primary:hover {
            background: #357ae8;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #666;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        .help-text {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 40px 20px;
            }
            
            .bookmark-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 20px;
            }
            
            .icon-wrapper {
                width: 70px;
                height: 70px;
            }

            .icon-wrapper img {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- ÊµÅÂä®Á∫øÊù°ËÉåÊôØ -->
    <svg class="wave" xmlns="http://www.w3.org/2000/svg">
        <path class="wave-path wave-path-1" d="M0,100 Q250,50 500,100 T1000,100 T1500,100 T2000,100" />
        <path class="wave-path wave-path-2" d="M0,200 Q300,150 600,200 T1200,200 T1800,200 T2400,200" />
        <path class="wave-path wave-path-3" d="M0,300 Q200,250 400,300 T800,300 T1200,300 T1600,300" />
        <path class="wave-path wave-path-1" d="M0,400 Q350,350 700,400 T1400,400 T2100,400" />
        <path class="wave-path wave-path-2" d="M0,500 Q280,480 560,500 T1120,500 T1680,500" />
        <path class="wave-path wave-path-3" d="M100,150 Q400,100 700,150 T1300,150 T1900,150" />
    </svg>

    <div class="container">
        <div class="bookmark-grid" id="bookmarkGrid">
            <!-- ‰π¶Á≠æÈ°πÂ∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÁîüÊàê -->
        </div>
    </div>

    <!-- Âè≥‰∏ãËßíËß¶ÂèëÂå∫Âüü -->
    <div class="edit-trigger-area" id="editTriggerArea"></div>

    <!-- ÂØºÂÖ•ÂØºÂá∫ÊåâÈíÆ -->
    <div class="import-export-btns">
        <button class="export-btn" id="exportBtn" title="ÂØºÂá∫‰π¶Á≠æ">üì§</button>
    </div>

    <!-- Ê∑ªÂä†‰π¶Á≠æÊåâÈíÆ -->
    <button class="add-bookmark-btn" id="addBookmarkBtn" title="Ê∑ªÂä†‰π¶Á≠æ">
        +
    </button>

    <!-- ÂÖ®Â±ÄÁºñËæëÊåâÈíÆ -->
    <button class="global-edit-btn" id="globalEditBtn" title="ÁºñËæëÊ®°Âºè">
        ‚úèÔ∏è
    </button>

    <!-- ÁºñËæëÂºπÁ™ó -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">ÁºñËæë‰π¶Á≠æ</div>
            <form id="editForm">
                <div class="form-group">
                    <label>ÂêçÁß∞</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label>ÁΩëÂùÄ</label>
                    <input type="text" id="editUrl" required>
                    <div class="help-text">ËæìÂÖ•ÁΩëÂùÄÔºåÂ¶Ç: www.example.comÔºàËá™Âä®Ê∑ªÂä† https://Ôºâ</div>
                </div>
                <div class="form-group">
                    <label>ÂõæÊ†áÁ±ªÂûã</label>
                    <select id="iconType">
                        <option value="auto">Ëá™Âä®Ëé∑ÂèñÁΩëÁ´ôÂõæÊ†á</option>
                        <option value="emoji">‰ΩøÁî®Ë°®ÊÉÖÁ¨¶Âè∑</option>
                        <option value="text">‰ΩøÁî®ÊñáÂ≠ó</option>
                        <option value="custom">Ëá™ÂÆö‰πâÂõæÁâáÈìæÊé•</option>
                    </select>
                </div>
                <div class="form-group" id="iconCustomGroup" style="display: none;">
                    <label>ÂõæÊ†áÂÜÖÂÆπ</label>
                    <input type="text" id="iconCustom" placeholder="ËæìÂÖ•Ë°®ÊÉÖÁ¨¶Âè∑„ÄÅÊñáÂ≠óÊàñÂõæÁâáÈìæÊé•">
                    <div class="help-text">Ë°®ÊÉÖÂ¶Ç: üé® / ÊñáÂ≠óÂ¶Ç: A / ÂõæÁâáÈìæÊé•Â¶Ç: https://...</div>
                </div>
                <div class="form-group">
                    <label>È¢ÑËßà</label>
                    <div class="icon-preview">
                        <div class="icon-preview-box" id="iconPreview">
                            <span>üìå</span>
                        </div>
                        <span id="namePreview">‰π¶Á≠æÂêçÁß∞</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-delete" id="deleteBtn">Âà†Èô§</button>
                    <button type="button" class="btn btn-secondary" id="cancelBtn">ÂèñÊ∂à</button>
                    <button type="submit" class="btn btn-primary">‰øùÂ≠ò</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ‰π¶Á≠æÊï∞ÊçÆ
        const bookmarks = [
            { name: 'Jemch', url: 'https://www.jemch.com', domain: 'jemch.com', fallback: 'J', iconType: 'auto' },
            { name: 'ÁΩëÁ´ôÊî∂Ëóè', url: '#', domain: '', fallback: 'üìë', iconType: 'emoji' },
            { name: 'YouTube', url: 'https://www.youtube.com', domain: 'youtube.com', fallback: 'Y', iconType: 'auto' },
            { name: 'SubEasy', url: 'https://www.subeasy.ai', domain: 'subeasy.ai', fallback: 'S', iconType: 'auto' },
            { name: 'ÂìîÂì©ÂìîÂì©', url: 'https://www.bilibili.com', domain: 'bilibili.com', fallback: 'B', badge: 'NEW', iconType: 'auto' },
            { name: 'Notion', url: 'https://www.notion.so', domain: 'notion.so', fallback: 'N', iconType: 'auto' },
            { name: 'Grok', url: 'https://grok.x.ai', domain: 'x.ai', fallback: 'G', iconType: 'auto' },
            { name: 'Claude', url: 'https://claude.ai', domain: 'claude.ai', fallback: 'C', iconType: 'auto' },
            { name: 'ChatGPT', url: 'https://chat.openai.com', domain: 'openai.com', fallback: 'C', iconType: 'auto' },
            { name: 'Gemini', url: 'https://gemini.google.com', domain: 'gemini.google.com', fallback: 'G', iconType: 'auto' },
            { name: 'ÈòøÈáå‰∫ëÁõò', url: 'https://www.alipan.com', domain: 'alipan.com', fallback: '‰∫ë', iconType: 'auto' },
            { name: 'Gmail', url: 'https://mail.google.com', domain: 'gmail.com', fallback: 'G', iconType: 'auto' },
            { name: 'Google Ëâ∫ÊúØ', url: 'https://artsandculture.google.com', domain: 'artsandculture.google.com', fallback: 'üé®', iconType: 'auto' },
            { name: 'Áª¥Âü∫ÁôæÁßë', url: 'https://zh.wikipedia.org', domain: 'wikipedia.org', fallback: 'W', iconType: 'auto' },
            { name: 'Google', url: 'https://www.google.com', domain: 'google.com', fallback: 'G', iconType: 'auto' },
            { name: 'Á∫ΩÁ∫¶Êó∂Êä•', url: 'https://www.nytimes.com', domain: 'nytimes.com', fallback: 'T', iconType: 'auto' },
            { name: 'BBC News ‰∏≠Êñá', url: 'https://www.bbc.com/zhongwen/simp', domain: 'bbc.com', fallback: 'BBC', iconType: 'auto' },
            { name: 'Ë±ÜÁì£ÁîµÂΩ±', url: 'https://movie.douban.com', domain: 'douban.com', fallback: 'Ë±Ü', iconType: 'auto' },
            { name: 'Áå´Ë∑≥ÁõòÊêú', url: 'https://www.maopan.top', domain: 'maopan.top', fallback: 'üê±', iconType: 'auto' },
            { name: 'UP‰∫ëÊêú', url: 'https://www.upyunso.com', domain: 'upyunso.com', fallback: 'üîç', iconType: 'auto' },
            { name: 'Á£ÅÂäõÁÜä', url: 'https://www.cilixiong.com', domain: 'cilixiong.com', fallback: 'üêº', iconType: 'auto' },
            { name: 'ÂæóÂà∞', url: 'https://www.dedao.cn', domain: 'dedao.cn', fallback: 'Âæó', iconType: 'auto' },
            { name: 'Shadowsocks', url: 'https://shadowsocks.org', domain: 'shadowsocks.org', fallback: 'S', iconType: 'auto' },
            { name: 'Internet Archive', url: 'https://archive.org', domain: 'archive.org', fallback: 'üèõÔ∏è', iconType: 'auto' },
            { name: 'GitHub', url: 'https://github.com', domain: 'github.com', fallback: 'GH', iconType: 'auto' },
            { name: 'ÂçïÂÖÉ 01 LED ÂÖÉ‰ª∂ÁöÑÂü∫Á°Ä...', url: '#', domain: '', fallback: 'Âçï', iconType: 'text' },
            { name: 'Êñ∞ÁñÜÊô∫ÊÖßËµãÁ§∫ÊïôÊäï...', url: '#', domain: '', fallback: 'Êñ∞', iconType: 'text' },
            { name: 'Sora', url: 'https://sora.com', domain: 'sora.com', fallback: 'S', iconType: 'auto' }
        ];

        // ‰ªé localStorage Âä†ËΩΩ‰π¶Á≠æÊï∞ÊçÆ
        function loadBookmarks() {
            const saved = localStorage.getItem('bookmarksData');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return bookmarks;
                }
            }
            return bookmarks;
        }

        // ‰øùÂ≠ò‰π¶Á≠æÊï∞ÊçÆ
        function saveBookmarks(data) {
            localStorage.setItem('bookmarksData', JSON.stringify(data));
        }

        // ‰ªé GitHub Âä†ËΩΩ‰π¶Á≠æ
        async function loadFromGitHub() {
            const githubUrl = 'https://324893.xyz/bookmarks.json';

            try {
                const response = await fetch(githubUrl);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                
                if (!Array.isArray(data)) {
                    throw new Error('Êï∞ÊçÆÊ†ºÂºèÈîôËØØ');
                }

                // ‰øùÂ≠òÂà∞Êú¨Âú∞
                saveBookmarks(data);
                return true;
            } catch (error) {
                console.error('‰ªéÊúçÂä°Âô®Âä†ËΩΩÂ§±Ë¥•:', error);
                return false;
            }
        }

        // Ê∏≤Êüì‰π¶Á≠æ
        function renderBookmarks() {
            const grid = document.getElementById('bookmarkGrid');
            const bookmarksData = loadBookmarks();
            
            grid.innerHTML = bookmarksData.map((bookmark, index) => {
                let iconHtml = '';
                
                if (bookmark.iconType === 'auto' && bookmark.domain) {
                    iconHtml = `
                        <img src="https://www.google.com/s2/favicons?domain=${bookmark.domain}&sz=128" 
                             alt="${bookmark.name}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="fallback" style="display:none;">${bookmark.fallback}</span>
                    `;
                } else if (bookmark.iconType === 'custom' && bookmark.customIcon && bookmark.customIcon.startsWith('http')) {
                    iconHtml = `
                        <img src="${bookmark.customIcon}" 
                             alt="${bookmark.name}" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <span class="fallback" style="display:none;">${bookmark.fallback}</span>
                    `;
                } else {
                    iconHtml = `<span class="fallback">${bookmark.customIcon || bookmark.fallback}</span>`;
                }
                
                return `
                    <a href="${bookmark.url}" 
                       class="bookmark-item" 
                       target="_blank" 
                       data-name="${bookmark.name}"
                       data-index="${index}"
                       draggable="true">
                        <div class="icon-wrapper">
                            ${iconHtml}
                            ${bookmark.badge ? `<span class="badge">${bookmark.badge}</span>` : ''}
                        </div>
                        <div class="bookmark-name">${bookmark.name}</div>
                        <button class="edit-btn" onclick="event.preventDefault(); event.stopPropagation(); openEditModal(${index})">‚úèÔ∏è</button>
                    </a>
                `;
            }).join('');

            // Ê∑ªÂä†ÊãñÊãΩ‰∫ã‰ª∂ÁõëÂê¨
            initDragAndDrop();
        }

        // ÊãñÊãΩÂäüËÉΩ
        let draggedElement = null;
        let draggedIndex = null;
        let dropIndicator = null;

        // ÂàõÂª∫ÊèíÂÖ•ÊåáÁ§∫Âô®
        function createDropIndicator() {
            const indicator = document.createElement('div');
            indicator.className = 'drop-indicator';
            return indicator;
        }

        function initDragAndDrop() {
            const items = document.querySelectorAll('.bookmark-item');

            // ÂàõÂª∫ÂÖ®Â±ÄÊåáÁ§∫Âô®
            if (!dropIndicator) {
                dropIndicator = createDropIndicator();
                document.body.appendChild(dropIndicator);
            }

            items.forEach((item, index) => {
                item.addEventListener('dragstart', handleDragStart);
                item.addEventListener('dragend', handleDragEnd);
                item.addEventListener('dragover', handleDragOver);
                item.addEventListener('drop', handleDrop);
                item.addEventListener('dragenter', handleDragEnter);
                item.addEventListener('dragleave', handleDragLeave);
            });
        }

        function handleDragStart(e) {
            draggedElement = this;
            draggedIndex = parseInt(this.dataset.index);
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // ÁßªÈô§ÊâÄÊúâÈ´ò‰∫Æ
            document.querySelectorAll('.bookmark-item').forEach(item => {
                item.classList.remove('drag-over');
            });

            // ÈöêËóèÊåáÁ§∫Âô®
            if (dropIndicator) {
                dropIndicator.classList.remove('show');
            }
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';

            // ÊòæÁ§∫ÊèíÂÖ•ÊåáÁ§∫Âô®
            if (this !== draggedElement && dropIndicator) {
                const rect = this.getBoundingClientRect();
                const dropIndex = parseInt(this.dataset.index);
                
                // Âà§Êñ≠ÊèíÂÖ•‰ΩçÁΩÆÔºàÂ∑¶‰æßÊàñÂè≥‰æßÔºâ
                const mouseX = e.clientX;
                const itemCenterX = rect.left + rect.width / 2;
                
                if (draggedIndex < dropIndex) {
                    // ‰ªéÂ∑¶ÂæÄÂè≥ÊãñÔºåÊòæÁ§∫Âú®Âè≥‰æß
                    dropIndicator.className = 'drop-indicator show right';
                    dropIndicator.style.left = rect.right + 'px';
                } else {
                    // ‰ªéÂè≥ÂæÄÂ∑¶ÊãñÔºåÊòæÁ§∫Âú®Â∑¶‰æß
                    dropIndicator.className = 'drop-indicator show left';
                    dropIndicator.style.left = rect.left + 'px';
                }
                
                dropIndicator.style.top = rect.top + 'px';
                dropIndicator.style.height = rect.height + 'px';
            }

            return false;
        }

        function handleDragEnter(e) {
            if (this !== draggedElement) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }

            if (draggedElement !== this) {
                const dropIndex = parseInt(this.dataset.index);
                const grid = document.getElementById('bookmarkGrid');
                const items = Array.from(grid.children);

                // ÈáçÊñ∞ÊéíÂàóÂÖÉÁ¥†
                if (draggedIndex < dropIndex) {
                    grid.insertBefore(draggedElement, this.nextSibling);
                } else {
                    grid.insertBefore(draggedElement, this);
                }

                // Êõ¥Êñ∞Á¥¢Âºï
                Array.from(grid.children).forEach((item, idx) => {
                    item.dataset.index = idx;
                });

                // ‰øùÂ≠òÊñ∞È°∫Â∫è
                saveBookmarkOrder();
            }

            this.classList.remove('drag-over');
            
            // ÈöêËóèÊåáÁ§∫Âô®
            if (dropIndicator) {
                dropIndicator.classList.remove('show');
            }

            return false;
        }

        // ‰øùÂ≠ò‰π¶Á≠æÈ°∫Â∫è
        function saveBookmarkOrder() {
            const items = document.querySelectorAll('.bookmark-item');
            const bookmarksData = loadBookmarks();
            const newOrder = [];
            
            items.forEach(item => {
                const name = item.dataset.name;
                const bookmark = bookmarksData.find(b => b.name === name);
                if (bookmark) {
                    newOrder.push(bookmark);
                }
            });
            
            saveBookmarks(newOrder);
        }

        // ÁºñËæëÂäüËÉΩ
        let currentEditIndex = null;

        function openEditModal(index) {
            currentEditIndex = index;
            const bookmarksData = loadBookmarks();
            const bookmark = bookmarksData[index];
            
            document.getElementById('editName').value = bookmark.name;
            document.getElementById('editUrl').value = bookmark.url;
            document.getElementById('iconType').value = bookmark.iconType || 'auto';
            document.getElementById('iconCustom').value = bookmark.customIcon || '';
            
            // ÊòæÁ§∫Âà†Èô§ÊåâÈíÆ
            document.getElementById('deleteBtn').style.display = 'block';
            
            updateIconCustomGroup();
            updatePreview();
            
            document.getElementById('editModal').classList.add('show');
        }

        function openAddModal() {
            currentEditIndex = null;
            
            // Ê∏ÖÁ©∫Ë°®Âçï
            document.getElementById('editName').value = '';
            document.getElementById('editUrl').value = '';
            document.getElementById('iconType').value = 'auto';
            document.getElementById('iconCustom').value = '';
            
            // ÈöêËóèÂà†Èô§ÊåâÈíÆ
            document.getElementById('deleteBtn').style.display = 'none';
            
            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.querySelector('.modal-header').textContent = 'Ê∑ªÂä†‰π¶Á≠æ';
            
            updateIconCustomGroup();
            updatePreview();
            
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            document.querySelector('.modal-header').textContent = 'ÁºñËæë‰π¶Á≠æ';
            currentEditIndex = null;
        }

        function updateIconCustomGroup() {
            const iconType = document.getElementById('iconType').value;
            const customGroup = document.getElementById('iconCustomGroup');
            const customInput = document.getElementById('iconCustom');
            
            if (iconType === 'auto') {
                customGroup.style.display = 'none';
            } else {
                customGroup.style.display = 'block';
                if (iconType === 'emoji') {
                    customInput.placeholder = 'ËæìÂÖ•Ë°®ÊÉÖÁ¨¶Âè∑ÔºåÂ¶Ç: üé®';
                } else if (iconType === 'text') {
                    customInput.placeholder = 'ËæìÂÖ•ÊñáÂ≠óÔºåÂ¶Ç: A';
                } else if (iconType === 'custom') {
                    customInput.placeholder = 'ËæìÂÖ•ÂõæÁâáÈìæÊé•ÔºåÂ¶Ç: https://...';
                }
            }
            updatePreview();
        }

        function updatePreview() {
            const name = document.getElementById('editName').value || '‰π¶Á≠æÂêçÁß∞';
            const url = document.getElementById('editUrl').value;
            const iconType = document.getElementById('iconType').value;
            const customIcon = document.getElementById('iconCustom').value;
            const preview = document.getElementById('iconPreview');
            
            document.getElementById('namePreview').textContent = name;
            
            if (iconType === 'auto' && url) {
                try {
                    const domain = new URL(url).hostname;
                    preview.innerHTML = `<img src="https://www.google.com/s2/favicons?domain=${domain}&sz=128" alt="${name}" onerror="this.style.display='none';">`;
                } catch {
                    preview.innerHTML = '<span>üîó</span>';
                }
            } else if (iconType === 'custom' && customIcon && customIcon.startsWith('http')) {
                preview.innerHTML = `<img src="${customIcon}" alt="${name}" onerror="this.parentElement.innerHTML='<span>‚ùå</span>';">`;
            } else {
                preview.innerHTML = `<span>${customIcon || 'üìå'}</span>`;
            }
        }

        function saveEdit() {
            const bookmarksData = loadBookmarks();
            const name = document.getElementById('editName').value.trim();
            let url = document.getElementById('editUrl').value.trim();
            const iconType = document.getElementById('iconType').value;
            const customIcon = document.getElementById('iconCustom').value.trim();
            
            if (!name || !url) {
                alert('ËØ∑Â°´ÂÜôÂêçÁß∞ÂíåÁΩëÂùÄ');
                return;
            }

            // Ëá™Âä®Ê∑ªÂä† https:// ÂâçÁºÄ
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            // È™åËØÅ URL Ê†ºÂºè
            try {
                new URL(url);
            } catch {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÁΩëÂùÄ');
                return;
            }
            
            // ÂàõÂª∫‰π¶Á≠æÂØπË±°
            const bookmark = {
                name,
                url,
                iconType,
                customIcon,
                domain: iconType === 'auto' ? new URL(url).hostname : '',
                fallback: customIcon || name.charAt(0)
            };

            if (currentEditIndex === null) {
                // Ê∑ªÂä†Êñ∞‰π¶Á≠æ
                bookmarksData.push(bookmark);
            } else {
                // Êõ¥Êñ∞Áé∞Êúâ‰π¶Á≠æ
                bookmarksData[currentEditIndex] = {
                    ...bookmarksData[currentEditIndex],
                    ...bookmark
                };
            }
            
            saveBookmarks(bookmarksData);
            closeEditModal();
            renderBookmarks();
        }

        function deleteBookmark() {
            if (currentEditIndex === null) return;
            
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰π¶Á≠æÂêóÔºü')) return;
            
            const bookmarksData = loadBookmarks();
            bookmarksData.splice(currentEditIndex, 1);
            saveBookmarks(bookmarksData);
            closeEditModal();
            renderBookmarks();
        }

        // ÈòªÊ≠¢ÈªòËÆ§ÁöÑÁÇπÂáªË°å‰∏∫ÔºàÊãñÊãΩÊó∂Ôºâ
        document.addEventListener('DOMContentLoaded', async () => {
            // Ëá™Âä®‰ªéÊúçÂä°Âô®Âä†ËΩΩÊúÄÊñ∞‰π¶Á≠æ
            const loaded = await loadFromGitHub();
            if (loaded) {
                console.log('Â∑≤‰ªéÊúçÂä°Âô®ÂêåÊ≠•ÊúÄÊñ∞‰π¶Á≠æ');
            }

            renderBookmarks();
            
            // ÈòªÊ≠¢ÊãñÊãΩÊó∂ÊâìÂºÄÈìæÊé•
            document.addEventListener('click', (e) => {
                const item = e.target.closest('.bookmark-item');
                if (item && item.classList.contains('dragging')) {
                    e.preventDefault();
                }
            });

            // Âè≥‰∏ãËßíËß¶ÂèëÂå∫Âüü - Èº†Ê†áÁßªÂÖ•ÊòæÁ§∫ÁºñËæëÊåâÈíÆ
            const triggerArea = document.getElementById('editTriggerArea');
            triggerArea.addEventListener('mouseenter', () => {
                document.body.classList.add('show-edit-btn');
            });

            triggerArea.addEventListener('mouseleave', () => {
                // Â¶ÇÊûú‰∏çÂú®ÁºñËæëÊ®°ÂºèÔºåÂàôÈöêËóèÊåâÈíÆ
                if (!document.body.classList.contains('edit-mode')) {
                    document.body.classList.remove('show-edit-btn');
                }
            });

            // ÂÖ®Â±ÄÁºñËæëÊåâÈíÆ
            document.getElementById('globalEditBtn').addEventListener('click', () => {
                document.body.classList.toggle('edit-mode');
                const btn = document.getElementById('globalEditBtn');
                if (document.body.classList.contains('edit-mode')) {
                    btn.textContent = '‚úì';
                    btn.title = 'ÂÆåÊàêÁºñËæë';
                    document.body.classList.add('show-edit-btn');
                } else {
                    btn.textContent = '‚úèÔ∏è';
                    btn.title = 'ÁºñËæëÊ®°Âºè';
                }
            });

            // Ê∑ªÂä†‰π¶Á≠æÊåâÈíÆ
            document.getElementById('addBookmarkBtn').addEventListener('click', () => {
                openAddModal();
            });

            // ÂØºÂá∫‰π¶Á≠æ
            const exportBtn = document.getElementById('exportBtn');
            if (exportBtn) {
                exportBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const bookmarksData = loadBookmarks();
                    const dataStr = JSON.stringify(bookmarksData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = 'bookmarks.json';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                    
                    alert('‰π¶Á≠æÂ∑≤ÂØºÂá∫‰∏∫ bookmarks.jsonÔºÅ\n\nËØ∑Â∞ÜÊ≠§Êñá‰ª∂‰∏ä‰º†Âà∞ https://324893.xyz/bookmarks.json ‰ª•Êõ¥Êñ∞Âú®Á∫øÊï∞ÊçÆ„ÄÇ');
                });
            }

            // ÁºñËæëÂºπÁ™ó‰∫ã‰ª∂
            document.getElementById('iconType').addEventListener('change', updateIconCustomGroup);
            document.getElementById('editName').addEventListener('input', updatePreview);
            document.getElementById('editUrl').addEventListener('input', updatePreview);
            document.getElementById('iconCustom').addEventListener('input', updatePreview);
            document.getElementById('cancelBtn').addEventListener('click', closeEditModal);
            document.getElementById('deleteBtn').addEventListener('click', deleteBookmark);
            
            document.getElementById('editForm').addEventListener('submit', (e) => {
                e.preventDefault();
                saveEdit();
            });

            // ÁÇπÂáªÂºπÁ™óÂ§ñÈÉ®ÂÖ≥Èó≠
            document.getElementById('editModal').addEventListener('click', (e) => {
                if (e.target.id === 'editModal') {
                    closeEditModal();
                }
            });
        });
    </script>
</body>
</html>
